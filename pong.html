<!doctype html>
<html>
	<head>
		<meta charset="utf-8" />
		<link href="ui.css" rel="stylesheet"/>
		<title>weGGe Pong</title>
	</head>
	
	<body>	
	</body>

	<script src="lib/three.js" language="javascript"></script>	
	<script src="lib/physi.js" language="javascript"></script>	
	<script>
		'use strict';

		Physijs.scripts.worker = 'lib/physijs_worker.js';
		Physijs.scripts.ammo = 'ammo.js';
	</script>
	
	<script src="lib/jquery.min.js" language="javascript"></script>
	<script src="lib/helvetiker_regular.typeface.js" language="javascript"></script>

	<script src="js/tools.js" language="javascript"></script>
	<script src="js/host3d.js" language="javascript"></script>
	<script src="js/controls.js" language="javascript"></script>

	<script src="js/nodes/node.js" language="javascript"></script>	
	<script src="js/nodes/level.js" language="javascript"></script>
	<script src="js/nodes/objects/object.js" language="javascript"></script>
	<script src="js/nodes/objects/group.js" language="javascript"></script>
	<script src="js/nodes/objects/basic.js" language="javascript"></script>
	<script src="js/nodes/objects/mesh.js" language="javascript"></script>
	
	<script src="js/nodes/resources/resources.js" language="javascript"></script>
	<script src="js/nodes/resources/resource.js" language="javascript"></script>
	<script src="js/nodes/resources/material.js" language="javascript"></script>
	<script src="js/nodes/resources/phy_material.js" language="javascript"></script>
	<script src="js/nodes/resources/texture.js" language="javascript"></script>
	<script src="js/nodes/resources/model.js" language="javascript"></script>
	
	<script src="js/nodes/actors/actor.js" language="javascript"></script>
	<script src="js/nodes/actors/clickable.js" language="javascript"></script>
	<script src="js/nodes/actors/moving.js" language="javascript"></script>
	<script src="js/nodes/actors/turning.js" language="javascript"></script>
	<script src="js/nodes/actors/spawn.js" language="javascript"></script>
	<script src="js/nodes/actors/physics.js" language="javascript"></script>
	
	<script src="js/ui/ui.js" language="javascript"></script>
	<script src="js/ui/viewer.js" language="javascript"></script>
	<script src="js/ui/resources.js" language="javascript"></script>

	<script>
	
		var viewer;
	
		var pongialized = false;
		var cube_actor, left_hand, right_hand;
		
		function pushLeft() {			
			if (pongialized) {
				cube_actor.pushZ(-25);
			}
		}
		
		function pushRight() {			
			if (pongialized) {
				cube_actor.pushZ(25);
			}
		}
		
		function pushUp() {			
			if (pongialized) {
				cube_actor.pushY(25);
			}
		}
		
		function pushDown() {			
			if (pongialized) {
				cube_actor.pushY(-25);
			}
		}
		
		function onKeyUp(e) {
			var key = e.keyCode ? e.keyCode : e.charCode;
			console.log("key:" + key);
			switch( key ) {
				case 32, 87: /* space, W */
					pushUp();
					break;
				case 83: /* S */
					pushDown();
					break;
				case 37, 65: /* left, A */
					pushLeft();
					break;
				case 39, 68: /* right, D */
					pushRight();
					break;
				case 27: /*ESC*/
					viewer.loadLevelList();
			}
		}
	
		function rightHandUp() {
			if (pongialized) {
				right_hand.wrapper.position.y += 2;
				right_hand.wrapper.__dirtyPosition = true;
			}
		}
		
		function rightHandDown() {
			if (pongialized) {
				right_hand.wrapper.position.y -= 2;
				right_hand.wrapper.__dirtyPosition = true;
			}
		}
		
		var mouseX, mouseY;
		
		function onMouseMove(event) {
			if (mouseY > event.pageY) {
				rightHandUp();
			} else if (mouseY < event.pageY) {
				rightHandDown();
			}
			mouseX = event.pageX;
			mouseY = event.pageY;
		}
		
		function initPong() {
			cube_actor = viewer.level.findNodeByName("cube_actor");
			cube_actor.target.wrapper.setAngularFactor(_v(1,0,1));
			cube_actor.target.wrapper.setLinearFactor(_v(0,1,1));
			
			cube_actor.target.wrapper.addEventListener( 'collision', function( other_object, relative_velocity, relative_rotation, contact_normal ) {
				//this.setAngularVelocity(_v(0,0,0));		
				//this.setLinearVelocity(_v(0,this.linearVelocity.y,this.linearVelocity.z));
				//this.rotation.set(0,0,0);
				//this.__dirtyRotation = true;				
			});
			
			left_hand = viewer.level.findNodeByName("left_hand");
			right_hand = viewer.level.findNodeByName("right_hand");
			window.document.addEventListener( 'keyup', onKeyUp );
			window.document.addEventListener( 'mousemove', onMouseMove );
	
			pongialized = true;
		}
		
		$(function () {
			viewer = new weggeViewer();
			viewer.onLevelLoaded = initPong;
			viewer.startLoadingLevel(31);			
		});
		
	</script>
		
</html>

